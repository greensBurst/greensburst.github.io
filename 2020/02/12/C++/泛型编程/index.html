<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="李素晴"><meta name="copyright" content="李素晴"><meta name="generator" content="Hexo 5.1.1"><meta name="theme" content="hexo-theme-yun"><title>泛型编程 | Lisuqing's Personal Website</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/star-markdown-css@0.1.21/dist/yun/yun-markdown.min.css"><script src="//at.alicdn.com/t/font_2138379_1l6ur2tg9f2.js" async></script><script src="https://cdn.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>document.addEventListener("DOMContentLoaded", () => {
  [".post-card",".post-content img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
});
</script><link rel="shortcut icon" type="image/svg+xml" href="/photo/icon.png"><link rel="mask-icon" href="/photo/icon.png" color="#0078E7"><link rel="alternate icon" href="/yun.ico"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="preload" href="/js/utils.js" as="script"><link rel="preload" href="/js/hexo-theme-yun.js" as="script"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script id="yun-config">
    const Yun = window.Yun || {};
    window.CONFIG = {"hostname":"lisuqing2020.github.io","root":"/","title":"李素晴的日记","version":"1.2.0","mode":"time","copycode":true,"anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"https://v1.hitokoto.cn","hitokoto":true},"local_search":{"path":"/search.xml"},"fireworks":{"colors":["102, 167, 221","62, 131, 225","33, 78, 194"]}};
  </script><script data-ad-client="ca-pub-9695375546022807" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><meta name="description" content="一. 函数模板 函数模板的目的   设计通用的函数，以适应广泛的数据型式   函数模板的定义格式   template&lt;模板型式参数列表&gt; 返回值型式 函数名称(参数列表); 原型：template&lt;class T&gt; void Swap(T &amp;a, T &amp;b); 实现：template&lt;class T&gt; void Swap(T &amp;a,">
<meta property="og:type" content="article">
<meta property="og:title" content="泛型编程">
<meta property="og:url" content="http://lisuqing2020.github.io/2020/02/12/C++/%E6%B3%9B%E5%9E%8B%E7%BC%96%E7%A8%8B/index.html">
<meta property="og:site_name" content="Lisuqing&#39;s Personal Website">
<meta property="og:description" content="一. 函数模板 函数模板的目的   设计通用的函数，以适应广泛的数据型式   函数模板的定义格式   template&lt;模板型式参数列表&gt; 返回值型式 函数名称(参数列表); 原型：template&lt;class T&gt; void Swap(T &amp;a, T &amp;b); 实现：template&lt;class T&gt; void Swap(T &amp;a,">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-02-12T09:01:14.000Z">
<meta property="article:modified_time" content="2020-11-22T05:30:19.304Z">
<meta property="article:author" content="李素晴">
<meta property="article:tag" content="thuC++">
<meta name="twitter:card" content="summary"><script src="/js/ui/mode.js"></script></head><body><script defer src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script defer src="/js/ui/fireworks.js"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="Table of Contents"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="Overview"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="李素晴"><img width="96" loading="lazy" src="/photo/avatar.jpg" alt="李素晴"></a><div class="site-author-name"><a href="/about/">李素晴</a></div><a class="site-name" href="/about/site.html">Lisuqing's Personal Website</a><sub class="site-subtitle"></sub><div class="site-desciption"></div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="首页"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/archives/" title="Archives"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">230</span></a></div><div class="site-state-item"><a href="/categories/" title="Categories"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder--line"></use></svg></span><span class="site-state-item-count">10</span></a></div><div class="site-state-item"><a href="/tags/" title="Tags"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag--line"></use></svg></span><span class="site-state-item-count">21</span></a></div><a class="site-state-item hty-icon-button" href="/about" title="留言板"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-clipboard-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://wpa.qq.com/msgrd?v=3&amp;uin=1164919034&amp;site=qq&amp;menu=yes" title="QQ" target="_blank" style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/lisuqing2020" title="GitHub" target="_blank" style="color:#181717"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:lisuqing2020@gmail.com" title="E-Mail" target="_blank" style="color:#8E71C1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mail-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://juejin.im/user/676954896099847" title="掘金" target="_blank" style="color:#0084FF"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-juejin"></use></svg></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" target="_blank" rel="noopener" href="https://nobilta.github.io/" title="东农吴彦祖" style="color:dodgerblue"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-genderless-line"></use></svg></a><a class="links-item hty-icon-button" target="_blank" rel="noopener" href="https://happycpp.github.io/" title="渣王" style="color:hotpink"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-women-line"></use></svg></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-contrast-2-line"></use></svg></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80-%E5%87%BD%E6%95%B0%E6%A8%A1%E6%9D%BF"><span class="toc-number">1.</span> <span class="toc-text">一. 函数模板</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E6%A8%A1%E6%9D%BF%E7%9A%84%E7%9B%AE%E7%9A%84"><span class="toc-number">1.0.1.</span> <span class="toc-text">函数模板的目的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E6%A8%A1%E6%9D%BF%E7%9A%84%E5%AE%9A%E4%B9%89%E6%A0%BC%E5%BC%8F"><span class="toc-number">1.0.2.</span> <span class="toc-text">函数模板的定义格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E6%A8%A1%E6%9D%BF%E7%9A%84%E4%BD%93%E5%8C%96%E4%B8%8E%E7%89%B9%E5%8C%96"><span class="toc-number">1.0.3.</span> <span class="toc-text">函数模板的体化与特化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E5%AD%90%E7%9A%84%E7%9B%AE%E7%9A%84"><span class="toc-number">1.0.4.</span> <span class="toc-text">函子的目的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E5%AD%90%E7%9A%84%E4%BC%98%E7%82%B9"><span class="toc-number">1.0.5.</span> <span class="toc-text">函子的优点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E5%AD%90%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.0.6.</span> <span class="toc-text">函子实现</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89-%E5%AE%8C%E7%BE%8E%E8%BD%AC%E5%8F%91"><span class="toc-number">2.</span> <span class="toc-text">三. 完美转发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%8C%E7%BE%8E%E8%BD%AC%E5%8F%91%E7%9A%84%E6%84%8F%E4%B9%89"><span class="toc-number">2.0.1.</span> <span class="toc-text">完美转发的意义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%8C%E7%BE%8E%E8%BD%AC%E5%8F%91%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%AD%96%E7%95%A5"><span class="toc-number">2.0.2.</span> <span class="toc-text">完美转发的实现策略</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B-%E7%B1%BB%E6%A8%A1%E6%9D%BF"><span class="toc-number">3.</span> <span class="toc-text">四. 类模板</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E6%A8%A1%E6%9D%BF%E7%9A%84%E7%9B%AE%E7%9A%84"><span class="toc-number">3.0.1.</span> <span class="toc-text">类模板的目的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E6%A8%A1%E6%9D%BF%E7%9A%84%E5%AE%9A%E4%B9%89%E6%A0%BC%E5%BC%8F"><span class="toc-number">3.0.2.</span> <span class="toc-text">类模板的定义格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E6%A8%A1%E6%9D%BF%E7%9A%84%E6%88%90%E5%91%98"><span class="toc-number">3.0.3.</span> <span class="toc-text">类模板的成员</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E6%88%90%E5%91%98%E5%87%BD%E6%95%B0%E7%9A%84%E6%A8%A1%E6%9D%BF"><span class="toc-number">3.0.4.</span> <span class="toc-text">类成员函数的模板</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E6%A8%A1%E6%9D%BF%E7%9A%84%E4%BC%98%E5%8C%96"><span class="toc-number">3.0.5.</span> <span class="toc-text">类模板的优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E6%A8%A1%E6%9D%BF%E7%9A%84%E6%98%BE%E5%BC%8F%E4%BD%93%E5%8C%96"><span class="toc-number">3.0.6.</span> <span class="toc-text">类模板的显式体化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E6%A8%A1%E6%9D%BF%E7%9A%84%E6%98%BE%E5%BC%8F%E7%89%B9%E5%8C%96"><span class="toc-number">3.0.7.</span> <span class="toc-text">类模板的显式特化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E6%A8%A1%E6%9D%BF%E7%9A%84%E7%BC%BA%E7%9C%81%E6%A8%A1%E6%9D%BF%E5%8F%82%E6%95%B0"><span class="toc-number">3.0.8.</span> <span class="toc-text">类模板的缺省模板参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%9B%E5%9E%8B%E7%BC%96%E7%A8%8B%E5%AE%9E%E7%8E%B0%E7%9A%84%E9%98%9F%E5%88%97"><span class="toc-number">3.0.9.</span> <span class="toc-text">泛型编程实现的队列</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94-%E5%85%83%E7%BC%96%E7%A8%8B"><span class="toc-number">4.</span> <span class="toc-text">五. 元编程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%85%83%E7%BC%96%E7%A8%8B%EF%BC%9F"><span class="toc-number">4.0.1.</span> <span class="toc-text">什么是元编程？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E5%8F%AF%E4%BB%A5%E8%BF%9B%E8%A1%8C%E5%85%83%E7%BC%96%E7%A8%8B%EF%BC%9F"><span class="toc-number">4.0.2.</span> <span class="toc-text">为什么可以进行元编程？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E5%85%83%E7%BC%96%E7%A8%8B%EF%BC%9F"><span class="toc-number">4.0.3.</span> <span class="toc-text">为什么需要元编程？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%83%E7%BC%96%E7%A8%8B%E7%9A%84%E7%BC%BA%E7%82%B9"><span class="toc-number">4.0.4.</span> <span class="toc-text">元编程的缺点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%83%E7%BC%96%E7%A8%8B%E5%8F%AF%E4%BB%A5%E5%81%9A%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">4.0.5.</span> <span class="toc-text">元编程可以做什么？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Fibonacci%E6%95%B0%E5%88%97"><span class="toc-number">4.0.6.</span> <span class="toc-text">Fibonacci数列</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AD-%E6%B3%9B%E5%9E%8B%E7%BC%96%E7%A8%8B%E5%AE%9E%E8%B7%B5%EF%BC%9A%E4%BA%8B%E4%BB%B6%E6%9C%BA%E5%88%B6"><span class="toc-number">5.</span> <span class="toc-text">六. 泛型编程实践：事件机制</span></a></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="post-block" itemscope itemtype="https://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://lisuqing2020.github.io/2020/02/12/C++/%E6%B3%9B%E5%9E%8B%E7%BC%96%E7%A8%8B/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="李素晴"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="Lisuqing's Personal Website"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">泛型编程</h1><div class="post-meta"><div class="post-time" style="display:inline-block"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span> <time title="Created: 2020-02-12 17:01:14" itemprop="dateCreated datePublished" datetime="2020-02-12T17:01:14+08:00">2020-02-12</time><span class="post-meta-divider">-</span><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-2-line"></use></svg></span> <time title="Modified: 2020-11-22 13:30:19" itemprop="dateModified" datetime="2020-11-22T13:30:19+08:00">2020-11-22</time></div><span class="post-busuanzi"><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="Views"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-eye-line"></use></svg> <span id="busuanzi_value_page_pv"></span></span></span><div class="post-classify"><span class="post-category"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-line"></use></svg></span> <span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category" href="/categories/C/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">C++</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag" href="/tags/thuC/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">thuC++</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body" style="--smc-primary:#0078E7;"><a id="more"></a>

<h1 id="一-函数模板"><a href="#一-函数模板" class="headerlink" title="一. 函数模板"></a>一. 函数模板</h1><ol>
<li><h3 id="函数模板的目的"><a href="#函数模板的目的" class="headerlink" title="函数模板的目的"></a>函数模板的目的</h3></li>
</ol>
<ul>
<li>设计通用的函数，以适应广泛的数据型式</li>
</ul>
<ol start="2">
<li><h3 id="函数模板的定义格式"><a href="#函数模板的定义格式" class="headerlink" title="函数模板的定义格式"></a>函数模板的定义格式</h3></li>
</ol>
<ul>
<li>template&lt;模板型式参数列表&gt; 返回值型式 函数名称(参数列表);</li>
<li>原型：<code>template&lt;class T&gt; void Swap(T &amp;a, T &amp;b);</code></li>
<li>实现：<code>template&lt;class T&gt; void Swap(T &amp;a, T &amp;b) &#123;...&#125;</code></li>
</ul>
<ol start="3">
<li><h3 id="函数模板的体化与特化"><a href="#函数模板的体化与特化" class="headerlink" title="函数模板的体化与特化"></a>函数模板的体化与特化</h3></li>
</ol>
<ul>
<li><p>针对特定型参数，在声明或第一次调用该函数模板时体化</p>
</li>
<li><p>每次体化都形成针对特定型参数的重载函数版本</p>
</li>
<li><p>文件最终只保留特定型参数的一份体化后的函体</p>
</li>
<li><p>显式体化主要用于库设计，显式特化覆盖体化的同型函体</p>
  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数模板</span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">void</span> <span class="title">f</span><span class="params">(T t)</span> </span>&#123;<span class="comment">/*...*/</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 显式体化：使用显式的长整型模板参数</span></span><br><span class="line"><span class="keyword">template</span> <span class="keyword">void</span> f&lt;<span class="keyword">long</span>&gt;(<span class="keyword">long</span> n);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 显式体化：使用d的型式推导模板参数型式</span></span><br><span class="line"><span class="function"><span class="keyword">template</span> <span class="keyword">void</span> <span class="title">f</span><span class="params">(<span class="keyword">double</span> d)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 显式特化：使用显式的整型参数</span></span><br><span class="line"><span class="keyword">template</span>&lt;&gt; <span class="keyword">void</span> f&lt;<span class="keyword">int</span>&gt;(<span class="keyword">int</span> n);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 显式特化：使用c的型式推导模板参数型式</span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;&gt; <span class="keyword">void</span> <span class="title">f</span><span class="params">(<span class="keyword">char</span> c)</span></span>;</span><br></pre></td></tr></table></figure>

  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">/* 交换函数 */</span></span><br><span class="line">    <span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">void</span> <span class="title">Swap</span><span class="params">(T &amp;a, T &amp;b)</span> </span>&#123;</span><br><span class="line">        T t;</span><br><span class="line">        t = a, a = b, b = t;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> m = <span class="number">11</span>, n = <span class="number">7</span>;</span><br><span class="line">        <span class="keyword">char</span> a = <span class="string">&#x27;A&#x27;</span>, b = <span class="string">&#x27;B&#x27;</span>;</span><br><span class="line">        <span class="keyword">double</span> c = <span class="number">1.0</span>, d = <span class="number">2.0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 正确调用，体化Swap(int&amp;, int&amp;)</span></span><br><span class="line">        Swap(m,n);</span><br><span class="line">        <span class="comment">// 正确调用，体化Swap(char&amp;, char&amp;)</span></span><br><span class="line">        Swap&lt;<span class="keyword">char</span>&gt;(m,n);</span><br><span class="line">        <span class="comment">// 正确调用，体化Swap(double&amp;, double&amp;)</span></span><br><span class="line">        Swap&lt;<span class="keyword">double</span>&gt;(c,d);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"># 二. 函子</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span> ### 编写函数，求某个数据集的最小元，元素型式为T</span><br><span class="line">- 实现策略：使用函数指针作为回调函数参数</span><br><span class="line">- 实现策略：使用函子(function object,functor)作为回调函数参数</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> ### 函数指针实现</span><br><span class="line">    ```C++</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">    <span class="function"><span class="keyword">const</span> T &amp; <span class="title">Min</span><span class="params">(<span class="keyword">const</span> T *a, <span class="keyword">int</span> n, <span class="keyword">bool</span> (*comparer)(<span class="keyword">const</span> T&amp;, <span class="keyword">const</span> T&amp;))</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> index = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(comparer(a[i],a[index])) &#123;</span><br><span class="line">                index = i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> a[index];</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="3">
<li><h3 id="函子的目的"><a href="#函子的目的" class="headerlink" title="函子的目的"></a>函子的目的</h3></li>
</ol>
<ul>
<li>功能上：类似函数指针</li>
<li>实现上：重载函数调用操作符，必要时重载小于比较操作符</li>
</ul>
<ol start="4">
<li><h3 id="函子的优点"><a href="#函子的优点" class="headerlink" title="函子的优点"></a>函子的优点</h3></li>
</ol>
<ul>
<li>函数指针不能内联，而函子可以，效率更高</li>
<li>函子可以拥有任意数量的额外数据，可以保存结果和状态，提高代码灵活性</li>
<li>编译时可对函子进行型式检查</li>
</ul>
<ol start="5">
<li><h3 id="函子实现"><a href="#函子实现" class="headerlink" title="函子实现"></a>函子实现</h3> <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="class"><span class="keyword">class</span> <span class="title">Comparer</span> &#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="comment">// 确保型式T已存在或重载operator&lt;</span></span><br><span class="line">        <span class="function"><span class="keyword">bool</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">const</span> T &amp;a, <span class="keyword">const</span> T &amp;b)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> a &lt; b;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> Comparer&gt;</span><br><span class="line"><span class="function"><span class="keyword">const</span> T &amp; <span class="title">Min</span><span class="params">(<span class="keyword">const</span> T *a, <span class="keyword">int</span> n, Comparer comparer)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> index = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(comparer(a[i],a[index])) &#123;</span><br><span class="line">            index = i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> a[index];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a[<span class="number">5</span>] = &#123;<span class="number">8</span>,<span class="number">7</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> min = Min(a,<span class="number">5</span>,Comparer&lt;<span class="keyword">int</span>&gt;());	<span class="comment">//构造匿名函子作为函数参数</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; min &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h1 id="三-完美转发"><a href="#三-完美转发" class="headerlink" title="三. 完美转发"></a>三. 完美转发</h1><ol>
<li><h3 id="完美转发的意义"><a href="#完美转发的意义" class="headerlink" title="完美转发的意义"></a>完美转发的意义</h3></li>
</ol>
<ul>
<li>库的设计者需要设计一个通用函数，将接收到的参数转发给其他函数</li>
<li>转发过程中，所有参数保持原先语义不变</li>
</ul>
<ol start="2">
<li><h3 id="完美转发的实现策略"><a href="#完美转发的实现策略" class="headerlink" title="完美转发的实现策略"></a>完美转发的实现策略</h3></li>
</ol>
<ul>
<li>当需要同时提供移动语义与拷贝语义时，要求重载大量构造函数，编程工作量巨大，易出错  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;utility&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> &#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        A(<span class="keyword">const</span> <span class="keyword">int</span> &amp;a, <span class="keyword">const</span> <span class="keyword">int</span> &amp;b):_a(a),_b(b) &#123;&#125;</span><br><span class="line">        A(<span class="keyword">const</span> <span class="keyword">int</span> &amp;a, <span class="keyword">int</span> &amp;&amp;b):_a(a),_b(move(b)) &#123;&#125;</span><br><span class="line">        A(<span class="keyword">int</span> &amp;&amp;a, <span class="keyword">const</span> <span class="keyword">int</span> &amp;b):_a(move(a)),_b(b) &#123;&#125;</span><br><span class="line">        A(<span class="keyword">int</span> &amp;&amp;a, <span class="keyword">int</span> &amp;&amp;b):_a(move(a)),_b(move(b)) &#123;&#125;</span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">        <span class="keyword">int</span> _a, _b;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> b = <span class="number">2</span>;</span><br><span class="line">    <span class="function">A <span class="title">a1</span><span class="params">(a,b)</span></span>;</span><br><span class="line">    <span class="function">A <span class="title">a2</span><span class="params">(a,<span class="number">2</span>)</span></span>;</span><br><span class="line">    <span class="function">A <span class="title">a3</span><span class="params">(<span class="number">1</span>,b)</span></span>;</span><br><span class="line">    <span class="function">A <span class="title">a4</span><span class="params">(<span class="number">1</span>,<span class="number">2</span>)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>右值引用与函数模板相互配合，可以实现完美转发，极大降低代码编写量  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> &#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        根据实际参数型式生成不同的左值或右值引用的构造函数版本</span></span><br><span class="line"><span class="comment">        T1或T2可以为不同型，此处相同仅为示例</span></span><br><span class="line"><span class="comment">        实参推演时，使用引用折叠机制</span></span><br><span class="line"><span class="comment">        当形式参数为T&amp;&amp;型时，当且仅当实际参数为右值或右值引用时，</span></span><br><span class="line"><span class="comment">        实际参数才为右值引用</span></span><br><span class="line"><span class="comment">        引用折叠机制与const/volatile无关，保持其参数性质不变</span></span><br><span class="line"><span class="comment">        std::forward&lt;T&gt;(t)转发参数的右值引用T&amp;&amp;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T1, <span class="keyword">typename</span> T2&gt;</span><br><span class="line">    A(T1 &amp;&amp;a, T2 &amp;&amp;b):_a(forward&lt;T1&gt;(a)), _b(forward&lt;T2&gt;(b)) &#123;&#125;</span><br><span class="line">    <span class="comment">// 如果外面传来了rvalue临时变量, 它就转发rvalue并且启用move语义.</span></span><br><span class="line"> <span class="comment">// 如果外面传来了lvalue, 它就转发lvalue并且启用复制. 然后它也还能保留const.</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> _a, _b;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h1 id="四-类模板"><a href="#四-类模板" class="headerlink" title="四. 类模板"></a>四. 类模板</h1><ol>
<li><h3 id="类模板的目的"><a href="#类模板的目的" class="headerlink" title="类模板的目的"></a>类模板的目的</h3></li>
</ol>
<ul>
<li>设计通用的类型式，以适应广泛的成员数据型式</li>
</ul>
<ol start="2">
<li><h3 id="类模板的定义格式"><a href="#类模板的定义格式" class="headerlink" title="类模板的定义格式"></a>类模板的定义格式</h3></li>
</ol>
<ul>
<li>template&lt;模板型式参数列表&gt; class 类名称 {…}</li>
<li>原型：<code>template&lt;typename T&gt; class A;</code></li>
</ul>
<ol start="3">
<li><h3 id="类模板的成员"><a href="#类模板的成员" class="headerlink" title="类模板的成员"></a>类模板的成员</h3></li>
</ol>
<ul>
<li>像普通类的成员一样定义</li>
<li>定义在类中或类外均可，后者需要在类名后列些模板参数，以区别非模板类的成员函数</li>
<li><code>template&lt;typename T&gt; T A&lt;T&gt;::f(u)&#123;...&#125;</code></li>
</ul>
<ol start="4">
<li><h3 id="类成员函数的模板"><a href="#类成员函数的模板" class="headerlink" title="类成员函数的模板"></a>类成员函数的模板</h3></li>
</ol>
<ul>
<li>成员函数可以使用其他模板  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="class"><span class="keyword">class</span> <span class="title">A</span> &#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> U&gt; T <span class="title">f</span><span class="params">(<span class="keyword">const</span> U &amp;u)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">template</span>&lt;<span class="keyword">typename</span> U&gt;</span><br><span class="line">T A&lt;T&gt;::f(<span class="keyword">const</span> U &amp;u) &#123;...&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ol start="5">
<li><h3 id="类模板的优化"><a href="#类模板的优化" class="headerlink" title="类模板的优化"></a>类模板的优化</h3></li>
</ol>
<ul>
<li>与函数模板不同，类模板体化时必须给定模板实际参数，如<code>A&lt;T&gt; a;</code></li>
<li>类模板体化时，编译器生成模板类或成员函数的代码；成员函数在调用时体化，虚函数在类构造时体化</li>
</ul>
<ol start="6">
<li><h3 id="类模板的显式体化"><a href="#类模板的显式体化" class="headerlink" title="类模板的显式体化"></a>类模板的显式体化</h3></li>
</ol>
<ul>
<li><code>template class A&lt;int&gt;;</code></li>
<li>解决模板库的创建问题，库的使用者可能没有体化的机会，而未体化的模板定义不会出现在目标文件中</li>
<li>显式体化类模板后，显式体化其构造函数</li>
<li>其他成员函数可显式体化，也可不显式体化</li>
</ul>
<ol start="7">
<li><h3 id="类模板的显式特化"><a href="#类模板的显式特化" class="headerlink" title="类模板的显式特化"></a>类模板的显式特化</h3></li>
</ol>
<ul>
<li>使用特定的型或值显式特化类模板，以定制类模板代码，如：<code>template&lt;&gt; class A&lt;char&gt; &#123;...&#125;;</code></li>
<li>显式特化版本覆盖体化版本</li>
<li>显示特化并不要求与原始模板相同，特化版本可以具有不同的数据成员或成员函数</li>
<li>类模板可以部分特化，结果仍是类模板，以支持类模板的部分定制</li>
</ul>
<ol start="8">
<li><h3 id="类模板的缺省模板参数"><a href="#类模板的缺省模板参数" class="headerlink" title="类模板的缺省模板参数"></a>类模板的缺省模板参数</h3></li>
</ol>
<ul>
<li>与函数模板相同，类模板可以具有缺省模板参数</li>
</ul>
<ol start="9">
<li><h3 id="泛型编程实现的队列"><a href="#泛型编程实现的队列" class="headerlink" title="泛型编程实现的队列"></a>泛型编程实现的队列</h3> <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">QueueIsEmpty</span> &#123;</span>&#125;;	<span class="comment">//空队列异常类</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="class"><span class="keyword">class</span> <span class="title">QueueItem</span>;</span>	<span class="comment">//队列项类声明</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="class"><span class="keyword">class</span> <span class="title">Queue</span> &#123;</span></span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">        QueueItem&lt;T&gt; *_head, *_tail;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        Queue():_head(<span class="literal">nullptr</span>),_tail(<span class="literal">nullptr</span>) &#123;&#125;</span><br><span class="line">        <span class="keyword">virtual</span> ~Queue();</span><br><span class="line">        <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(<span class="keyword">const</span> T &amp; item)</span></span>;</span><br><span class="line">        <span class="function"><span class="keyword">virtual</span> T <span class="title">pop</span><span class="params">()</span></span>;</span><br><span class="line">        <span class="function"><span class="keyword">bool</span> <span class="title">empty</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> _head == <span class="literal">nullptr</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="class"><span class="keyword">class</span> <span class="title">QueueItem</span> &#123;</span></span><br><span class="line">    <span class="keyword">friend</span> <span class="class"><span class="keyword">class</span> <span class="title">Queue</span>&lt;</span>T&gt;;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">    T _item;</span><br><span class="line">    QueueItem&lt;T&gt; *_next;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">    QueueItem(<span class="keyword">const</span> T &amp; item):_item(item),_next(<span class="literal">nullptr</span>) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; Queue&lt;T&gt;::~Queue() &#123;</span><br><span class="line">    <span class="keyword">while</span>(empty()) &#123;</span><br><span class="line">        pop();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">void</span> Queue&lt;T&gt;::push(<span class="keyword">const</span> T &amp; item) &#123;</span><br><span class="line">    QueueItem&lt;T&gt; *p = <span class="keyword">new</span> QueueItem&lt;T&gt;(item);</span><br><span class="line">    <span class="keyword">if</span>(empty()) &#123;</span><br><span class="line">        _head = _tail = p;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        _tail -&gt; _next = p;</span><br><span class="line">        _tail = p;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; T Queue&lt;T&gt;::pop() &#123;</span><br><span class="line">    <span class="keyword">if</span>(empty()) &#123;</span><br><span class="line">        <span class="keyword">throw</span> QueueIsEmpty();</span><br><span class="line">    &#125;</span><br><span class="line">    QueueItem&lt;T&gt; *p = _head;</span><br><span class="line">    T _retval = p -&gt; _item;</span><br><span class="line">    _head = _head -&gt; _next;</span><br><span class="line">    <span class="keyword">delete</span> p;</span><br><span class="line">    <span class="keyword">return</span> _retval;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Queue&lt;<span class="keyword">int</span>&gt; *p = <span class="keyword">new</span> Queue&lt;<span class="keyword">int</span>&gt;;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">        p -&gt; push(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; p -&gt; pop() &lt;&lt; <span class="built_in">endl</span>;	<span class="comment">// 0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> *r = <span class="keyword">new</span> <span class="keyword">int</span>(<span class="number">10</span>), *q = <span class="keyword">new</span> <span class="keyword">int</span>(<span class="number">20</span>);</span><br><span class="line">    Queue&lt;<span class="keyword">int</span>*&gt; *t = <span class="keyword">new</span> Queue&lt;<span class="keyword">int</span>*&gt;;</span><br><span class="line">    t -&gt; push(r);</span><br><span class="line">    t -&gt; push(q);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; *(t -&gt; pop()) &lt;&lt; <span class="built_in">endl</span>;	<span class="comment">// 10</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h1 id="五-元编程"><a href="#五-元编程" class="headerlink" title="五. 元编程"></a>五. 元编程</h1><ol>
<li><h3 id="什么是元编程？"><a href="#什么是元编程？" class="headerlink" title="什么是元编程？"></a>什么是元编程？</h3></li>
</ol>
<ul>
<li>利用模板可以进行编译器计算(数值计算、型式计算和代码计算)的特点进行程序设计</li>
</ul>
<ol start="2">
<li><h3 id="为什么可以进行元编程？"><a href="#为什么可以进行元编程？" class="headerlink" title="为什么可以进行元编程？"></a>为什么可以进行元编程？</h3></li>
</ol>
<ul>
<li>C++是两层语言：执行编译期计算的代码称为静态代码，执行运行期计算的代码称为动态代码</li>
<li>模板可用于<strong>函数式编程</strong>：强调抽象计算，充实模块化，使用递归控制流程</li>
<li>模板是图灵完备的：理论上模板可以执行任何计算任务</li>
</ul>
<ol start="3">
<li><h3 id="为什么需要元编程？"><a href="#为什么需要元编程？" class="headerlink" title="为什么需要元编程？"></a>为什么需要元编程？</h3></li>
</ol>
<ul>
<li>编译器计算可以使代码更通用，更易用，提升程序执行性能</li>
</ul>
<ol start="4">
<li><h3 id="元编程的缺点"><a href="#元编程的缺点" class="headerlink" title="元编程的缺点"></a>元编程的缺点</h3></li>
</ol>
<ul>
<li>相对结构化编程，编译效率极低</li>
<li>代码丑陋不堪，阅读难，调试难，维护难，易导致代码膨胀</li>
</ul>
<ol start="5">
<li><h3 id="元编程可以做什么？"><a href="#元编程可以做什么？" class="headerlink" title="元编程可以做什么？"></a>元编程可以做什么？</h3></li>
</ol>
<ul>
<li>数值序列计算、素数判定、控制结构、循环展开、型式判定、表达式、编译期多态、特性、策略、标签、元容器、…</li>
<li>注：对操作系统编程而言，元编程意义不大</li>
</ul>
<ol start="6">
<li><h3 id="Fibonacci数列"><a href="#Fibonacci数列" class="headerlink" title="Fibonacci数列"></a>Fibonacci数列</h3> <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">int</span> i = <span class="number">1</span>&gt; class Fibonacci &#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">enum</span> &#123;</span><br><span class="line">        value = Fibonacci&lt;i<span class="number">-1</span>&gt;::value + Fibonacci&lt;i<span class="number">-2</span>&gt;::value</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;&gt; <span class="class"><span class="keyword">class</span> <span class="title">Fibonacci</span>&lt;</span><span class="number">2</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">    <span class="class"><span class="keyword">enum</span> &#123;</span></span><br><span class="line">        value = <span class="number">1</span></span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;&gt; <span class="class"><span class="keyword">class</span> <span class="title">Fibonacci</span>&lt;</span><span class="number">1</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">    <span class="class"><span class="keyword">enum</span> &#123;</span></span><br><span class="line">        value = <span class="number">1</span></span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; Fibonacci&lt;<span class="number">7</span>&gt;::value &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h1 id="六-泛型编程实践：事件机制"><a href="#六-泛型编程实践：事件机制" class="headerlink" title="六. 泛型编程实践：事件机制"></a>六. 泛型编程实践：事件机制</h1><blockquote>
<p>有一说一，看不太懂…太复杂了</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Empty</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">&#125;; <span class="comment">// 空类，用于指代响应对象</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 事件响应者类模板，保存特定事件的响应者与响应行为</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> EventAction&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EventResponsor</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>: <span class="comment">// 公开数据成员，以方便使用者</span></span><br><span class="line">	Empty *actor;</span><br><span class="line">	EventAction *action;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	EventResponsor(Empty *actor, EventAction *action) : actor(actor), action(action) &#123;&#125;</span><br><span class="line">	<span class="keyword">friend</span> <span class="keyword">bool</span> <span class="keyword">operator</span>==(<span class="keyword">const</span> EventResponsor &amp;lhs, <span class="keyword">const</span> EventResponsor &amp;rhs)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> lhs.actor == rhs.actor &amp;&amp; *lhs.action == *rhs.action;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 事件类模板，用于管理特定事件的所有响应者</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> EventAction&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Event</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="keyword">typedef</span> <span class="built_in">vector</span>&lt;EventResponsor&lt;EventAction&gt;&gt; EventResponsors;</span><br><span class="line">	<span class="keyword">typedef</span> <span class="keyword">typename</span> <span class="built_in">vector</span>&lt;EventResponsor&lt;EventAction&gt;&gt;::iterator EventIterator; <span class="comment">// 这里的typename是类型名指示符</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	EventResponsors _ers;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="keyword">virtual</span> ~Event()</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span> (EventIterator it = <span class="keyword">this</span>-&gt;_ers.begin(); it != <span class="keyword">this</span>-&gt;_ers.end(); it++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">delete</span> it-&gt;action;</span><br><span class="line">			it-&gt;action = <span class="literal">nullptr</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">EventResponsors &amp;<span class="title">GetResponsors</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>-&gt;_ers;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 事件绑定，将实际响应者和响应行为挂接到响应者对象上</span></span><br><span class="line">	<span class="keyword">template</span> &lt;<span class="keyword">typename</span> Responsor, <span class="keyword">typename</span> Action&gt;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Bind</span><span class="params">(Responsor *actor, Action action)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		Action *act = <span class="keyword">new</span> Action(action);</span><br><span class="line">		<span class="function">EventResponsor&lt;EventAction&gt; <span class="title">er</span><span class="params">((Empty *)actor, (EventAction *)act)</span></span>;</span><br><span class="line">		<span class="keyword">bool</span> unbound = <span class="literal">true</span>;</span><br><span class="line">		<span class="keyword">for</span> (EventIterator it = <span class="keyword">this</span>-&gt;_ers.begin(); it != <span class="keyword">this</span>-&gt;_ers.end(); it++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (*it == er)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">// 发现重复的事件响应者，说明已绑定</span></span><br><span class="line">				unbound = <span class="literal">false</span>;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (unbound)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">this</span>-&gt;_ers.push_back(er);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">delete</span> er.action;</span><br><span class="line">			er.action = <span class="literal">nullptr</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 解除事件绑定，删除事件响应者对象</span></span><br><span class="line">	<span class="keyword">template</span> &lt;<span class="keyword">typename</span> Responsor, <span class="keyword">typename</span> Action&gt;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Unbind</span><span class="params">(Responsor *actor, Action action)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		Action *act = <span class="keyword">new</span> Action(action);</span><br><span class="line">		<span class="function">EventResponsor&lt;EventAction&gt; <span class="title">er</span><span class="params">((Empty *)actor, (EventAction *)act)</span></span>;</span><br><span class="line">		<span class="keyword">for</span> (EventIterator it = <span class="keyword">this</span>-&gt;_ers.begin(); it != <span class="keyword">this</span>-&gt;_ers.end(); ++it)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (*it == er)</span><br><span class="line">			&#123; <span class="comment">// 找到待删除的事件响应者对象</span></span><br><span class="line">				<span class="keyword">delete</span> it-&gt;action;</span><br><span class="line">				<span class="keyword">this</span>-&gt;_ers.erase(it);</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">delete</span> er.action;</span><br><span class="line">		er.action = <span class="literal">NULL</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  定义事件委托模型、指向类成员函数的指针</span></span><br><span class="line"><span class="keyword">typedef</span> Empty EventDelegator;</span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span> <span class="params">(EventDelegator::*ValueChanged)</span><span class="params">(<span class="keyword">int</span> value, <span class="keyword">void</span> *tag)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  触发者</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Trigger</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	Trigger() : _value(<span class="number">0</span>) &#123;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">SetValue</span><span class="params">(<span class="keyword">int</span> value, <span class="keyword">void</span> *tag)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">GetValue</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> _value; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="comment">//  值变化事件，公开属性，方便在类外设定</span></span><br><span class="line">	Event&lt;ValueChanged&gt; value_changed;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="keyword">int</span> _value;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  设定值，遍历特定事件的响应对象列表，逐一触发值变更事件</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Trigger::SetValue</span><span class="params">(<span class="keyword">int</span> value, <span class="keyword">void</span> *tag)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (_value == value)</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	_value = value;</span><br><span class="line">	Event&lt;ValueChanged&gt;::EventResponsors ers;</span><br><span class="line">	ers = <span class="keyword">this</span>-&gt;value_changed.GetResponsors();</span><br><span class="line">	<span class="keyword">if</span> (!ers.empty())</span><br><span class="line">	&#123;</span><br><span class="line">		Event&lt;ValueChanged&gt;::EventIterator it;</span><br><span class="line">		<span class="keyword">for</span> (it = ers.begin(); it != ers.end(); ++it)</span><br><span class="line">		&#123;</span><br><span class="line">			((it-&gt;actor)-&gt;*(*(it-&gt;action)))(value, tag); <span class="comment">//  响应事件</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  行动者</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Actor</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="comment">//  侦听事件，绑定本对象的事件响应函数到侦听的事件</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Listen</span><span class="params">(Trigger *trigger)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		trigger-&gt;value_changed.Bind(<span class="keyword">this</span>, &amp;Actor::OnValueChanged);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//  停止侦听，从侦听的事件中取消绑定本对象的事件响应活动</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Unlisten</span><span class="params">(Trigger *trigger)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		trigger-&gt;value_changed.Unbind(<span class="keyword">this</span>, &amp;Actor::OnValueChanged);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//  值变更事件的响应函数</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">OnValueChanged</span><span class="params">(<span class="keyword">int</span> value, <span class="keyword">void</span> *tag)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">char</span> *&gt;(tag) &lt;&lt; value &lt;&lt; <span class="string">&quot;.&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">char</span> *s = <span class="string">&quot;Now the value is &quot;</span>;</span><br><span class="line">	Trigger t;</span><br><span class="line">	Actor a1, a2;</span><br><span class="line"></span><br><span class="line">	a1.Listen(&amp;t);</span><br><span class="line">	a2.Listen(&amp;t);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Listening...&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	t.SetValue(<span class="number">10</span>, <span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">void</span> *&gt;(<span class="keyword">const_cast</span>&lt;<span class="keyword">char</span> *&gt;(s)));</span><br><span class="line"></span><br><span class="line">	a2.Unlisten(&amp;t);</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Listening again...&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	t.SetValue(<span class="number">20</span>, <span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">void</span> *&gt;(<span class="keyword">const_cast</span>&lt;<span class="keyword">char</span> *&gt;(s)));</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul class="post-copyright"><li class="post-copyright-author"><strong>Post author: </strong>李素晴</li><li class="post-copyright-link"><strong>Post link: </strong><a href="http://lisuqing2020.github.io/2020/02/12/C++/%E6%B3%9B%E5%9E%8B%E7%BC%96%E7%A8%8B/" title="泛型编程">http://lisuqing2020.github.io/2020/02/12/C++/%E6%B3%9B%E5%9E%8B%E7%BC%96%E7%A8%8B/</a></li><li class="post-copyright-license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a> unless stating additionally.</li></ul></section></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/2020/02/12/C++/class%E4%B8%8Etypename/" rel="prev" title="class与typename"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-left-s-line"></use></svg><span class="post-nav-text">class与typename</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/2020/02/12/C++/%E6%A0%87%E5%87%86%E6%A8%A1%E6%9D%BF%E5%BA%93/" rel="next" title="标准模板库"><span class="post-nav-text">标准模板库</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-right-s-line"></use></svg></a></div></div></div><div id="comment"><div class="comment-tooltip text-center"><span>点击按钮跳转 GitHub Issues 评论。</span><br><span>若没有本文 Issue，您可以使用 Comment 模版新建。</span><br><a class="hty-button hty-button--raised" id="github-issues" target="_blank" rel="noopener" href="https://github.com/lisuqing2020/lisuqing2020.github.io/issues?q=is:issue+泛型编程">GitHub Issues</a></div><div id="valine-container"></div><script src="https://cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script><script>function initValine() {
  const valineConfig = {"enable":true,"appId":null,"appKey":null,"placeholder":"你看一晃两三年，匆匆又夏天","avatar":null,"pageSize":10,"visitor":false,"highlight":true,"recordIP":false,"enableQQ":true,"appid":"p14aECEQvrlk4brHLOn0nij4-gzGzoHsz","appkey":"J93LFcbKRj9xFjUo40L5y1sj","meta":["nick","mail","link"],"el":"#valine-container","lang":"en"}
  valineConfig.path = window.location.pathname
  new Valine(valineConfig)
}
setTimeout(initValine, 1000)</script></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2019 – 2020 </span><span class="with-love" id="animate"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> 李素晴</span></div><div class="powered"><span>Powered by <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> v5.1.1</span><span class="footer-separator">|</span><span>Theme - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.2.0</span></div><div id="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv" title="Total Visitors"><span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-user-line"></use></svg></span><span id="busuanzi_value_site_uv"></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv" title="Total Views"><span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-eye-line"></use></svg></span><span id="busuanzi_value_site_pv"></span></span></div></footer><a class="hty-icon-button" id="goUp" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a><a class="popup-trigger hty-icon-button icon-search" id="search" href="javascript:;" title="Search"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search-line"></use></svg></span></a><script>window.addEventListener("DOMContentLoaded", () => {
  // Handle and trigger popup window
  document.querySelector(".popup-trigger").addEventListener("click", () => {
    document.querySelector(".popup").classList.add("show");
    setTimeout(() => {
      document.querySelector(".search-input").focus();
    }, 100);
  });

  // Monitor main search box
  const onPopupClose = () => {
    document.querySelector(".popup").classList.remove("show");
  };

  document.querySelector(".popup-btn-close").addEventListener("click", () => {
    onPopupClose();
  });

  window.addEventListener("keyup", event => {
    if (event.key === "Escape") {
      onPopupClose();
    }
  });
});
</script><script src="/js/search/local-search.js" defer></script><div class="popup search-popup"><div class="search-header"><span class="popup-btn-close close-icon hty-icon-button"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-close-line"></use></svg></span></div><div class="search-input-container"><input class="search-input" id="local-search-input" type="text" placeholder="Searching..." value=""></div><div id="local-search-result"></div></div></div><script defer src="/js/utils.js"></script><script defer src="/js/hexo-theme-yun.js"></script></body></html>